<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cek Nilai Paket</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
  </head>
  <body class="bg-gray-900 text-white min-h-screen p-4 sm:p-6">
    <div class="max-w-xl mx-auto space-y-6">
      <h1 class="text-2xl font-bold text-center mb-4">Cek Nilai Paket</h1>

      <div>
        <label for="nisInput" class="block mb-2">Masukkan NIS:</label>
        <input type="text" id="nisInput" class="w-full p-2 rounded bg-gray-800 text-white" placeholder="Contoh: 11303" />
      </div>

      <button onclick="cariData()" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded text-white w-full">Cari Data</button>

      <div id="hasil" class="bg-gray-800 p-4 rounded-lg mt-4 hidden space-y-2">
        <p><strong>Nama:</strong> <span id="namaSiswa"></span></p>
        <p><strong>Kelas:</strong> <span id="kelasSiswa"></span></p>
        <p><strong>Nilai Paket A (MTK, FIS, KIM, BIO):</strong> <span id="nilaiA"></span></p>
        <p><strong>Nilai Paket B (EKO, GEO, INF, SOSIO):</strong> <span id="nilaiB"></span></p>
        <p class="text-green-400 font-semibold"><strong>Paket Terbaik:</strong> <span id="paketTerbaik"></span></p>
      </div>
    </div>

    <script>
      let dataSiswa = [];

      const mapelIndex = {
        MTK: 3,
        FIS: 4,
        KIM: 5,
        BIO: 6,
        EKO: 7,
        INF: 8,
        GEO: 9,
        SOSIO: 10,
      };

      fetch("data.xlsx")
        .then((res) => res.arrayBuffer())
        .then((ab) => {
          const workbook = XLSX.read(ab, { type: "array" });
          const sheet = workbook.Sheets[workbook.SheetNames[0]];
          const json = XLSX.utils.sheet_to_json(sheet, { header: 1 });
          dataSiswa = json.slice(4); // Ambil mulai dari baris ke-5
        });

      function cariData() {
        const nis = document.getElementById("nisInput").value.trim();
        const hasil = document.getElementById("hasil");

        const siswa = dataSiswa.find((row) => String(row[0]) === nis);

        if (!siswa) {
          alert("Data tidak ditemukan!");
          hasil.classList.add("hidden");
          return;
        }

        const nama = siswa[1];
        const kelas = siswa[2];

        const paketAmapel = ["MTK", "FIS", "KIM", "BIO"];
        const paketBmapel = ["EKO", "GEO", "INF", "SOSIO"];

        const nilaiA1 = rataRata(paketAmapel.map((m) => siswa[mapelIndex[m]]));
        const nilaiB1 = rataRata(paketBmapel.map((m) => siswa[mapelIndex[m]]));

        const nilaiA = nilaiA1 * 4;
        const nilaiB = nilaiB1 * 4;

        const paketTerbaik = nilaiA > nilaiB ? "Paket A" : nilaiB > nilaiA ? "Paket B" : "Sama";

        document.getElementById("namaSiswa").textContent = nama;
        document.getElementById("kelasSiswa").textContent = kelas;
        document.getElementById("nilaiA").textContent = nilaiA.toFixed(2);
        document.getElementById("nilaiB").textContent = nilaiB.toFixed(2);
        document.getElementById("paketTerbaik").textContent = paketTerbaik;

        hasil.classList.remove("hidden");
      }

      function rataRata(nilaiArray) {
        const valid = nilaiArray.map((n) => parseFloat(n)).filter((n) => !isNaN(n));
        return valid.length ? valid.reduce((a, b) => a + b, 0) / valid.length : 0;
      }
    </script>
  </body>
</html>
